{% extends 'base.html' %}
{% load static %}
{% load cents_to_dollars %}

{% block title %}sponsoredissues.org{% endblock %}

{% block head %}
<style>
    body {
        font-family: Verdana, Geneva, sans-serif;
        font-size: 12pt;
        background: #f6f6ef;
        color: #000;
    }

    .container {
        max-width: 1024px;
        margin: 0 auto;
        padding: 20px 15px;
    }

    .main-content {
        background: white;
        padding: 40px;
        border: 1px solid #e6e6df;
    }

    .intro-section {
        margin-bottom: 50px;
    }

    .intro-content {
        flex: 1;
    }

    .intro-title {
        font-size: 18pt;
        color: #1e3a8a;
        margin-bottom: 10px;
        font-weight: bold;
    }

    .intro-text {
        line-height: 1.4;
        color: #333;
        margin: 16px 0px 16px 0px;
    }

    .intro-text ol {
        list-style-position: inside;
        padding-left: 0;
    }

    .intro-text ol li {
        margin: 8px 0px 8px 0px;
    }

    .intro-screenshot-mobile {
        margin: 20px 0;
    }

    .intro-screenshot-mobile img,
    .intro-screenshot-desktop img {
        width: 100%;
        max-width: 300px;
        height: auto;
        border: 1px solid #e6e6df;
        border-radius: 4px;
    }

    /* Mobile: show inline screenshot, hide desktop screenshot */
    .intro-screenshot-desktop {
        display: none;
    }

    .intro-screenshot-mobile {
        display: block;
    }

    .intro-text .sponsoredissues-label {
        padding: 2px 8px;
        font-size: 0.75rem;
        border-radius: 12px;
        border: 1px solid;
        background: #f0fdf4;
        color: #166534;
        border-color: #166534;
    }

    .featured-section {
        margin-bottom: 25px;
    }

    .section-header {
        font-size: 18pt;
        color: #1e3a8a;
        font-weight: bold;
        margin-bottom: 15px;
        border-bottom: 1px solid #e6e6df;
        padding-bottom: 5px;
    }

    .stats-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 70px;
    }

    .stat-box {
        background: #f8f9fa;
        padding: 15px;
        border: 1px solid #e6e6df;
    }

    .stat-title {
        font-weight: bold;
        color: #1e3a8a;
        margin-bottom: 8px;
    }

    .stat-value {
        font-size: 18pt;
        font-weight: bold;
        color: #059669;
        margin-bottom: 5px;
    }

    .stat-desc {
        color: #666;
        font-size: 9pt;
    }

    .btn {
        padding: 8px 16px;
        border: 1px solid #1e3a8a;
        text-decoration: none;
        font-weight: bold;
        border-radius: 3px;
        font-size: 10pt;
    }

    .btn-primary {
        background: #1e3a8a;
        color: white;
    }

    .btn:hover {
        opacity: 0.9;
    }

    .issue-item {
        padding: 12px;
        border-bottom: 1px solid #e6e6df;
        display: flex;
        gap: 12px;
    }

    .issue-item:last-child {
        border-bottom: none;
    }

    .issue-item:hover {
        background: #f8f9fa;
    }

    .issue-rank {
        font-weight: bold;
        color: #666;
        min-width: 20px;
        flex-shrink: 0;
    }

    .issue-content {
        flex: 1;
    }

    .issue-title {
        font-weight: bold;
        color: #1e3a8a;
        margin-bottom: 6px;
    }

    .issue-title a {
        color: #1e3a8a;
        text-decoration: none;
    }

    .issue-title a:hover {
        text-decoration: underline;
    }

    .issue-repo {
        font-size: 9pt;
        color: #666;
        margin-bottom: 6px;
    }

    .issue-stats {
        display: flex;
        gap: 15px;
        font-size: 9pt;
        color: #666;
        flex-wrap: wrap;
    }

    .issue-stat {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .issue-stat-value {
        font-weight: bold;
        color: #059669;
    }

    .no-trending {
        padding: 20px;
        text-align: center;
        color: #666;
        font-style: italic;
    }

    /* Desktop layout */
    @media (min-width: 769px) {
        .intro-columns {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }

        .intro-screenshot-desktop {
            display: block;
            flex: 0 0 400px;
            margin-top: 16px;
        }

        .intro-screenshot-desktop img {
            max-width: 400px;
        }

        /* Hide mobile screenshot on desktop */
        .intro-screenshot-mobile {
            display: none;
        }
    }

    @media (max-width: 768px) {

        .container {
            padding: 0px;
        }

        .main-content {
            padding: 30px;
        }

        .stats-section {
            grid-template-columns: 1fr;
        }

        .issue-stats {
            flex-direction: column;
            gap: 6px;
            align-items: flex-start;
        }

        .issue-stat {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="main-content">

        <div class="intro-section">
            <div class="intro-title">What is sponsoredissues.org?</div>
            <div class="intro-columns">
                <div class="intro-content">
                    <div class="intro-text">
                        <strong>sponsoredissues.org</strong> lets users assign their <a href="https://github.com/sponsors">GitHub Sponsors</a> donations to specific GitHub issues, in order to vote for which features and fixes get prioritized.
                    </div>

                    <!-- Screenshot appears here on mobile only -->
                    <div class="intro-screenshot-mobile">
                        <a href="{% static 'images/issues-page-mockup.png' %}">
                            <img src="{% static 'images/issues-page-mockup.png' %}" alt="SponsoredIssues issues page mockup showing funded GitHub issues">
                        </a>
                    </div>

                    <div class="intro-text">
                        The ability to assign donations to specific GitHub issues has two benefits:
                    </div>
                    <div class="intro-text">
                        <ol>
                            <li>It gives FOSS users an additional incentive to donate, because it gives them voting power.</li>
                            <li>It helps FOSS maintainers understand which issues are most important to their users.</li>
                        </ol>
                    </div>
                    <div class="intro-text">
                        Sponsoring an issue does not give the donor any guarantee about when the issue will be resolved â€” it is only for the purpose of user feedback. In addition, the maintainer chooses which specific issues are "sponsorable", by adding the <span class="sponsoredissues-label">sponsoredissues.org</span> issue label on GitHub.
                    </div>
                    <div class="intro-text">
                        For more detailed info about how the site works, please see the <a href="{% url 'faq' %}">FAQ</a>.
                    </div>
                    <div class="intro-text">
                        For help getting started as a FOSS maintainer, see: <a href="{% url 'faq' %}#get-started">How do I get started as a maintainer?</a>
                    </div>
                    <div class="intro-text">
                        For help getting started as a FOSS user/donor, see: <a href="{% url 'faq' %}#how-vote">How do I vote for issues on sponsoredissues.org?</a>
                    </div>
                    <div class="intro-text">
                        This website is free to use, and the source code is published on GitHub with an Aferro GPL license. If  want to support the site, or if you want to vote for future features/fixes, consider <a href="https://github.com/sponsors/benvvalk">donating to me on GitHub Sponsors</a>.
                    </div>
                </div>

                <!-- Screenshot appears here on desktop only -->
                <div class="intro-screenshot-desktop">
                    <a href="{% static 'images/issues-page-mockup.png' %}">
                        <img src="{% static 'images/issues-page-mockup.png' %}" alt="SponsoredIssues issues page mockup showing funded GitHub issues">
                    </a>
                </div>
            </div>
        </div>

        <div class="section-header">Stats</div>
        <div class="stats-section">
            <div class="stat-box">
                <div class="stat-title">Total Funded</div>
                <div class="stat-value">{{ total_funded_cents|cents_to_dollars }} USD</div>
                <div class="stat-desc">across {{ num_funded_repos }} repositor{% if num_funded_repos == 1 %}y{% else %}ies{% endif %}</div>
            </div>
            <div class="stat-box">
                <div class="stat-title">Issues Resolved</div>
                <div class="stat-value">{{ num_resolved_issues }}</div>
                <div class="stat-desc">with an average funding of {{ avg_resolved_cents|cents_to_dollars }} USD</div>
            </div>
        </div>

        <div class="featured-section">
            <div class="section-header">Trending Issues</div>
            {% if trending_issues %}
                {% for issue in trending_issues %}
                <div class="issue-item">
                    <div class="issue-rank">{{ forloop.counter }}.</div>
                    <div class="issue-content">
                        <div class="issue-title">
                            <a href="{% url 'repo_issues' issue.owner issue.repo %}" target="_blank">{{ issue.owner }}/{{ issue.repo }}</a>: <a href="{% url 'repo_issues' issue.owner issue.repo issue.number %}" target="_blank">{{ issue.title }}</a>
                        </div>
                        <div class="issue-stats">
                            <div class="issue-stat">
                                <span>Total:</span>
                                <span class="issue-stat-value">{{ issue.total_funding_cents|cents_to_dollars }} USD</span>
                            </div>
                            <div class="issue-stat">
                                <span>Recent (14d):</span>
                                <span class="issue-stat-value">{{ issue.recent_funding_cents|cents_to_dollars }} USD</span>
                            </div>
                            <div class="issue-stat">
                                <span>Sponsors:</span>
                                <span class="issue-stat-value">{{ issue.total_sponsors }}</span>
                            </div>
                            <div class="issue-stat">
                                <span>Last donation:</span>
                                <span>{{ issue.days_since_last_donation }}d ago</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-trending">
                    No trending issues yet.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}